{"version":3,"sources":["jasminegui/tradehistory.cljs"],"mappings":"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","names":["jasminegui.tradehistory/subs10","this","reagent.core/as-element","temp__5733__auto__","x","cljs.core.subs.cljs$core$IFn$_invoke$arity$3","jasminegui.tradehistory/nfh","jasminegui.tables/nf","re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","p__51058","vec__51059","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","db","_","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","jasminegui.tradehistory/modal-single-bond-trade-history","cljs.core/deref","modal-data","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","G__51156","re-frame.core/subscribe","cljs.core.keyword.cljs$core$IFn$_invoke$arity$1","G__51157","show-modal","G__51158","display","cljs.core/reverse","p1__51066#","cljs.core.remove.cljs$core$IFn$_invoke$arity$2","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","re-com.core/modal-panel","G__51159","re-frame.core/dispatch","re-com.core/v-box","re-com.core/h-box","re-com.core/title","G__51161","re-com.core/md-circle-icon-button","jasminegui.tools/csv-link","G__51162","re-com.core/box","re-com.core/throbber","js/module$node_modules$react_table$lib$index.default","jasminegui.tables/round2","cljs.core/count","jasminegui.tradehistory/modal-single-bond-flat-trade-history","G__51164","G__51165","cljs.core.sort_by.cljs$core$IFn$_invoke$arity$2","p1__51163#","cljs.core/some","cljs.core.println.cljs$core$IFn$_invoke$arity$variadic","G__51166","G__51174","G__51175","cljs.core.into.cljs$core$IFn$_invoke$arity$2","iter__4529__auto__","s__51190","cljs.core/LazySeq","temp__5735__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4527__auto__","size__4528__auto__","b__51192","cljs.core/chunk-buffer","i__51191","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__51189","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","p","G__51410","cljs.core/chunk-first"],"sourcesContent":["(ns jasminegui.tradehistory\r\n  (:require\r\n    ; [oz.core :as oz]\r\n    [re-frame.core :as rf]\r\n    [reagent.core :as r]\r\n    [goog.string :as gstring]\r\n    [goog.string.format]\r\n    [re-com.core :refer [p p-span h-box v-box box gap line scroller border label title button close-button checkbox hyperlink-href slider horizontal-bar-tabs radio-button info-button\r\n                         single-dropdown hyperlink modal-panel alert-box throbber input-password selection-list md-circle-icon-button\r\n                         input-text input-textarea popover-anchor-wrapper popover-content-wrapper popover-tooltip datepicker-dropdown] :refer-macros [handler-fn]]\r\n    [re-com.box :refer [h-box-args-desc v-box-args-desc box-args-desc gap-args-desc line-args-desc scroller-args-desc border-args-desc flex-child-style]]\r\n    [re-com.util :refer [px]]\r\n    [jasminegui.mount :as mount]\r\n    [jasminegui.static :as static]\r\n    [\"react-table\" :as rt :default ReactTable]\r\n\r\n\r\n    [re-com.validate :refer [string-or-hiccup? alert-type? vector-of-maps?]]\r\n    [jasminegui.tables :as tables]\r\n    [jasminegui.tools :as tools])\r\n  )\r\n\r\n\r\n\r\n(defn subs10 [this]\r\n  (r/as-element\r\n    (if-let [x (aget this \"value\")]\r\n      [:div  (subs x 0 10)]\r\n      \"-\")))\r\n\r\n(defn nfh [this]\r\n  (r/as-element\r\n    (if-let [x (aget this \"value\")]\r\n      [:div  (tables/nf x)]\r\n      \"\")))\r\n\r\n(rf/reg-event-db\r\n  :single-bond-trade-history/close-modal\r\n  (fn [db [_]]\r\n    (assoc db :single-bond-trade-history/bond nil\r\n              :single-bond-trade-history/data []\r\n              :single-bond-trade-history/flat-data []\r\n              :single-bond-trade-history/show-modal false\r\n              :single-bond-trade-history/show-flat-modal false\r\n              :single-bond-trade-history/show-throbber true)))\r\n\r\n\r\n(defn modal-single-bond-trade-history []\r\n  (let [\r\n        modal-data (get-in @(rf/subscribe [:single-bond-trade-history/data]) [(keyword @(rf/subscribe [:single-portfolio-risk/portfolio]))])\r\n        show-modal @(rf/subscribe [:single-bond-trade-history/show-modal])\r\n        display (reverse (remove #(= (:TransactionTypeName %) \"Coupon Payment\") modal-data))]\r\n    ;(println modal-data)\r\n    (if show-modal\r\n\r\n      [modal-panel\r\n       :wrap-nicely? true\r\n       :backdrop-on-click #(rf/dispatch [:single-bond-trade-history/close-modal])\r\n       :child\r\n       [v-box :gap \"10px\"\r\n        :children [\r\n                   [h-box :gap \"20px\" :align :center\r\n                    :children [\r\n                               [title :label (str @(rf/subscribe [:single-bond-trade-history/bond]) \" trades since 2019-01-01\") :level :level2]\r\n                               [md-circle-icon-button :md-icon-name \"zmdi-download\" :on-click #(tools/csv-link display \"trade-history\")]]]\r\n                   (if @(rf/subscribe [:single-bond-trade-history/show-throbber])\r\n                     [box :align :center :child [throbber :size :large]]\r\n                     [:> ReactTable\r\n                                        {:data           display\r\n                                         :columns        [{:Header \"Date\" :accessor \"TradeDate\" :width 100 :Cell subs10}\r\n                                                          {:Header \"Type\" :accessor \"TransactionTypeName\" :width 100}\r\n                                                          {:Header \"Notional\" :accessor \"Quantity\" :width 100 :style {:textAlign \"right\"} :Cell nfh}\r\n                                                          {:Header \"Price\" :accessor \"PriceLcl\" :width 100 :style {:textAlign \"right\"} :Cell tables/round2}\r\n                                                          {:Header \"Counterparty\" :accessor \"counterparty_code\" :width 100}\r\n                                                          ]\r\n                                         :showPagination false\r\n                                         :pageSize       (count display)\r\n                                         :className      \"-striped -highlight\"}])]]])))\r\n\r\n;(tools/download-object-as-csv (clj->js (tools/vector-of-maps->csv data)) (str filename \".csv\"))\r\n;[title :label \"Download:\" :level :level3]\r\n;[md-circle-icon-button :md-icon-name \"zmdi-download\" :on-click #(csv-link @(rf/subscribe [:single-portfolio-risk/table]) @portfolio)]]))]]]]]\r\n\r\n(defn modal-single-bond-flat-trade-history []\r\n  (let [\r\n        modal-data @(rf/subscribe [:single-bond-trade-history/flat-data])\r\n        show-modal @(rf/subscribe [:single-bond-trade-history/show-flat-modal])\r\n        display (reverse (sort-by :date (remove #(some #{(:trade %)} [\"Coupon Payment\" \"Scrip Transfer\"]) modal-data)))]\r\n    (println modal-data)\r\n    (if show-modal\r\n\r\n      [modal-panel\r\n       :wrap-nicely? true\r\n       :backdrop-on-click #(rf/dispatch [:single-bond-trade-history/close-modal])\r\n       :child\r\n       [v-box :gap \"20px\"\r\n        :children [[h-box :gap \"20px\" :align :center\r\n                    :children [[title :label (str @(rf/subscribe [:single-bond-trade-history/bond]) \" trades since 2019-01-01\") :level :level2]\r\n                               [md-circle-icon-button :md-icon-name \"zmdi-download\" :on-click #(tools/csv-link display \"trade-history\")]]]\r\n                               (if @(rf/subscribe [:single-bond-trade-history/show-throbber])\r\n                                 [box :align :center :child [throbber :size :large]]\r\n                                 [:> ReactTable\r\n                                  {:data           display\r\n                                   :columns        [{:Header \"Date\" :accessor \"date\" :width 100}\r\n                                                    {:Header \"Type\" :accessor \"trade\" :width 75}\r\n                                                    {:Header \"Price\" :accessor \"price\" :width 70 :style {:textAlign \"right\"} :Cell tables/round2}\r\n                                                    {:Header \"Portfolio\" :columns (into []\r\n                                                                                        (for [p @(rf/subscribe [:portfolios])]\r\n                                                                                          {:Header p :accessor p :width 90 :style {:textAlign \"right\"} :Cell nfh}))}\r\n                                                    ]\r\n                                   :showPagination false\r\n                                   :pageSize       (count display)\r\n                                   :className      \"-striped -highlight\"}])]]])))"]}