{"version":3,"sources":["kdlyticsgui/positions.cljs"],"mappings":"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","names":["kdlyticsgui.positions/halfrw","kdlyticsgui.positions/maxrw","re_frame.core.reg_event_db","p__31252","vec__31253","cljs.core.nth","db","_","cljs.core.assoc","kdlyticsgui.positions/modal-price-history","cljs.core/deref","modal-data","re_frame.core.subscribe","show-modal","re-com.core/modal-panel","re-frame.core/dispatch","re-com.core/v-box","re-com.core/h-box","re-com.core/title","re-com.core/gap","re-com.core/md-circle-icon-button","re-com.core/box","re-com.core/throbber","kdlyticsgui.tools/vega-lite","kdlyticsgui.chart/line-chart-price-hover","kdlyticsgui.positions/summary-display","cljs.core/empty?","helix.core/get-react","obj31258","obj31260","data-summary","data-top10","data-characteristics","data-characteristics-test","data-strategy-exposure","data-strategy-exposure-clean","p1__31256#","cljs.core.map","goog.string/format","columns-summary","kdlyticsgui.mrttables.text_col","kdlyticsgui.mrttables.nb_col","kdlyticsgui.mrttables/round0","kdlyticsgui.mrttables/round1","kdlyticsgui.mrttables/round2pc100","kdlyticsgui.mrttables/allocation-delta-formatting","kdlyticsgui.mrttables/nb-thousand-cell-format","kdlyticsgui.mrttables/round1pc","kdlyticsgui.mrttables/round2","kdlyticsgui.mrttables/round2pc","columns-characteristics","kdlyticsgui.chart/pie-chart-strategy","kdlyticsgui.mrttables/material-react-table-template-basic","kdlyticsgui.mrttables/mrt-table-toolbar","kdlyticsgui.mrttables/mrt-default-download-fn","kdlyticsgui.chart/bullet-chart-characteristic","kdlyticsgui.guitools/mrt-right-element-box-generic","kdlyticsgui.mrttables/material-react-table-template-fast","kdlyticsgui.mrttables/positions-full-row-formatting"],"sourcesContent":["(ns kdlyticsgui.positions\r\n  (:require [kdlyticsgui.guitools :as gt]\r\n            [kdlyticsgui.chart :as chart]\r\n            [kdlyticsgui.tools :as t]\r\n            [kdlyticsgui.mrttables :as mrt]\r\n            [re-frame.core :as rf]\r\n            [re-com.core :refer [p p-span h-box v-box box gap line scroller border label title button close-button checkbox hyperlink-href slider horizontal-bar-tabs radio-button info-button\r\n                                 single-dropdown hyperlink modal-panel alert-box throbber input-password selection-list md-circle-icon-button\r\n                                 input-text input-textarea popover-anchor-wrapper popover-content-wrapper popover-tooltip datepicker-dropdown] :refer-macros [handler-fn]]\r\n            [helix.core :refer [defnc $]]\r\n            [goog.string :as gstring]\r\n            )\r\n  )\r\n\r\n(def halfrw \"850px\")\r\n(def maxrw \"1790px\")\r\n\r\n(rf/reg-event-db\r\n  :price-history/close-modal\r\n  (fn [db [_]]\r\n    (assoc db :price-history/ticker nil\r\n              :price-history/name   nil\r\n              :price-history/data []\r\n              :price-history/show-modal false)))\r\n\r\n(defn modal-price-history []\r\n  (let [modal-data @(rf/subscribe [:price-history/data])\r\n        show-modal @(rf/subscribe [:price-history/show-modal])]\r\n    (if show-modal\r\n      [modal-panel\r\n       :wrap-nicely? true\r\n       :backdrop-on-click #(rf/dispatch [:price-history/close-modal])\r\n       :child\r\n       [v-box :gap \"10px\"\r\n        :children [[h-box :gap \"20px\" :align :center\r\n                    :children [[title :label \"Weekly price history since 2002\" :level :level2]\r\n                               [gap :size \"1\"]\r\n                               [md-circle-icon-button :md-icon-name \"zmdi-close\" :on-click #(rf/dispatch [:price-history/close-modal])]]]\r\n                   (if @(rf/subscribe [:price-history/show-throbber])\r\n                     [box :align :center :child [throbber :size :large]]\r\n                     [h-box :gap \"20px\" :children [[t/vega-lite (chart/line-chart-price-hover modal-data)]\r\n                                                   ]]\r\n                     )]]])))\r\n\r\n\r\n(defn summary-display []\r\n  (when (empty? @(rf/subscribe [:positions-summary])) (rf/dispatch [:get-positions-summary]))\r\n  (when (empty? @(rf/subscribe [:positions-top10])) (rf/dispatch [:get-positions-top10]))\r\n  (when (empty? @(rf/subscribe [:positions-characteristics])) (rf/dispatch [:get-positions-characteristics]))\r\n  (when (empty? @(rf/subscribe [:positions-strategy-exposure])) (rf/dispatch [:get-positions-strategy-exposure]))\r\n  (let [data-summary @(rf/subscribe [:positions-summary])\r\n        data-top10 @(rf/subscribe [:positions-top10])\r\n        data-characteristics @(rf/subscribe [:positions-characteristics])\r\n\r\n        data-characteristics-test [{:title \"Revenue\" :subtitle \"Revenue bla bla \" :ranges [150 225 300]  :measures [220 270] :markers [250]}\r\n                                   {:title \"Profit\" :subtitle \"Profit bla bla \" :ranges [15 22 30]  :measures [21 23] :markers [26]}]\r\n\r\n        data-strategy-exposure @(rf/subscribe [:positions-strategy-exposure])\r\n        data-strategy-exposure-clean (map #(assoc % :value-display (gstring/format \"%.2f%\" (* 100. (% :nav-eur-perc))) ) data-strategy-exposure)\r\n        columns-summary [{:header \"Description\" :id \"description\" :columns [(mrt/text-col \"Ticker\" \"ticker\" 60)\r\n                                                                    (mrt/text-col \"Cat.\" \"asset-class\" 60)\r\n                                                                    (mrt/text-col \"Acc.\" \"account\" 60)\r\n                                                                    (mrt/text-col \"CCY\" \"currency\" 60)\r\n                                                                    (mrt/text-col \"Name\" \"shortName\" 200)]}\r\n                 {:header \"Position & PnL\" :id \"position\" :columns [(mrt/nb-col \"Qt\" \"quantity\" 50 mrt/round0)\r\n                                                                    (mrt/nb-col \"CPU\" \"cost-per-unit\" 50 mrt/round1)\r\n                                                                    (mrt/nb-col \"Price\" \"regularMarketPrice\" 50 mrt/round1)\r\n                                                                    (mrt/nb-col \"Nav lcl\" \"nav-local\" 50 mrt/round0)\r\n                                                                    (mrt/nb-col \"Nav \u20ac\" \"nav-eur\" 50 mrt/round0)\r\n                                                                    (mrt/nb-col \"Nav \u20ac %\" \"nav-eur-perc\" 50 mrt/round2pc100) ;formating >5%\r\n                                                                    (mrt/nb-col \"Pnl lcl\" \"pnl-local\" 50 mrt/round0)\r\n                                                                    (mrt/nb-col \"Pnl \u20ac\" \"pnl-eur\" 50 mrt/round0)\r\n                                                                    (mrt/nb-col \"Pnl \u20ac %\" \"pnl-eur-perc\" 50 mrt/round2pc100)]}\r\n                 {:header \"Allocation\" :id \"allocation\" :columns [(mrt/text-col \"#\" \"nb-strategies\" 50)\r\n                                                                  (mrt/text-col \"Strategy 1\" \"strategy-1\" 50)\r\n                                                                  (mrt/text-col \"Strategy 2\" \"strategy-2\" 50)\r\n                                                                  (mrt/text-col \"Strategy 3\" \"strategy-3\" 50)\r\n                                                                  (mrt/nb-col \"Alloc. 1\" \"alloc-strat-1\" 50 mrt/round0)\r\n                                                                  (mrt/nb-col \"Alloc. 2\" \"alloc-strat-2\" 50 mrt/round0)\r\n                                                                  (mrt/nb-col \"Alloc. 3\" \"alloc-strat-3\" 50 mrt/round0)\r\n                                                                  (mrt/nb-col \"Total\" \"alloc-strat-total\" 50 mrt/round0)\r\n                                                                  (assoc (mrt/nb-col \"Delta\" \"alloc-strat-delta\" 50 mrt/round0) :muiTableBodyCellProps mrt/allocation-delta-formatting)]}\r\n                 {:header \"Quant metrics\" :id \"quant\" :columns [(mrt/nb-col \"Mkt Cap $mil\" \"marketCap\" 50 mrt/nb-thousand-cell-format)\r\n                                                                (mrt/nb-col \"Margin\" \"profitMargin\" 50 mrt/round0)\r\n                                                                (mrt/nb-col \"TrailEPS\" \"trailingEps\" 50 mrt/round0)\r\n                                                                (mrt/nb-col \"FwdEPS\" \"forwardEps\" 50 mrt/round0)\r\n                                                                (mrt/nb-col \"YTD\" \"ytdReturn\" 50 mrt/round1pc)\r\n                                                                (mrt/nb-col \"1Y\" \"52WeekChange\" 50 mrt/round1pc)\r\n                                                                (mrt/nb-col \"High1Y\" \"fiftyTwoWeekHigh\" 50 mrt/round1)\r\n                                                                (mrt/nb-col \"Low1Y\" \"fiftyTwoWeekLow\" 50 mrt/round1)\r\n                                                                (mrt/nb-col \"Beta\" \"beta\" 50 mrt/round1)\r\n                                                                (mrt/nb-col \"PE\" \"trailingPE\" 50 mrt/round1)\r\n                                                                (mrt/nb-col \"FwdPE\" \"forwardPE\" 50 mrt/round1)\r\n                                                                (mrt/nb-col \"PB\" \"priceToBook\" 50 mrt/round0)\r\n                                                                (mrt/nb-col \"EV/EB\" \"enterpriseToEbitda\" 50 mrt/round2)\r\n                                                                (mrt/nb-col \"BV\" \"bookValue\" 50 mrt/round0)\r\n                                                                (mrt/nb-col \"Div last\" \"lastDividendValue\" 50 mrt/round2)\r\n                                                                (mrt/nb-col \"Div %\" \"dividendYield\" 50 mrt/round2pc100)\r\n                                                                (mrt/nb-col \"Div % 5Y\" \"fiveYearAvgDividendYield\" 50 mrt/round2pc)\r\n                                                                (mrt/nb-col \"Payout\" \"payoutRatio\" 50 mrt/round2pc100)]}]\r\n        columns-characteristics [(mrt/text-col \"Metric\" \"metric\" 30) (mrt/nb-col \"Value\" \"value\" 90 mrt/round2)]\r\n        ]\r\n    ;(println data-strategy-exposure-clean)\r\n    ;(rf/dispatch [:get-price-history ticker])\r\n    [v-box :gap \"30px\"\r\n     :children [[h-box :class \"subbody rightelement\" :gap \"20px\" :children [[t/vega-lite (chart/pie-chart-strategy data-strategy-exposure-clean \"Strategy %\")]\r\n                                                                            ($ mrt/material-react-table-template-basic\r\n                                                                               {:clj-data data-characteristics\r\n                                                                                :clj-columns columns-characteristics\r\n                                                                                :clj-option-map   {:enableGrouping false :enablePinning false :enablePagination false}\r\n                                                                                :js-initial-state #js {\"density\" \"compact\" \"showColumnFilters\" false \"pagination\" #js {\"pageSize\" 50} \"grouping\" #js []}\r\n                                                                                :toolbar          mrt/mrt-table-toolbar\r\n                                                                                :download-fn      (mrt/mrt-default-download-fn \"characteristics-summary\" columns-characteristics)\r\n                                                                                :photo-id         \"characteristics-summary\"})\r\n                                                                            [t/vega-lite (chart/bullet-chart-characteristic data-characteristics-test \"TRY\")]\r\n                                                                            ]\r\n\r\n                 ]\r\n                [gt/mrt-right-element-box-generic \"positions-summary\" maxrw \"\" {}\r\n                 [($ mrt/material-react-table-template-fast\r\n                     {:clj-data data-summary\r\n                      :clj-columns columns-summary\r\n                      :clj-option-map   {:enableGrouping false :enablePinning true :enablePagination true :muiTableBodyRowProps mrt/positions-full-row-formatting :muiTableBodyProps nil}  ;to avoid the cell formatting to mess up this the row formatting :muiTableBodyRowProps, we set the :muiTableBodyProps to nil, cell format override row formating\r\n                      :js-initial-state #js {\"density\" \"compact\"\r\n                                             \"showColumnFilters\" true\r\n                                             \"pagination\" #js {\"pageSize\" 50}\r\n                                             \"grouping\" #js []\r\n                                             \"sorting\" #js [ #js{\"id\" \"nav-eur-perc\" \"desc\" true}]\r\n                                             \"columnVisibility\" #js {\"nav-local\" false \"pnl-local\" false \"strategy-3\" false \"alloc-strat-1\" false \"alloc-strat-2\" false \"alloc-strat-3\" false}}\r\n                      :toolbar          mrt/mrt-table-toolbar\r\n                      :download-fn      (mrt/mrt-default-download-fn \"positions-summary\" columns-summary)\r\n                      :photo-id         \"positions-summary\"})\r\n                  ]]]\r\n\r\n     ]\r\n    ))\r\n"]}