{"version":3,"sources":["jasminegui/tables.cljs"],"mappings":"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","names":["jasminegui.tables/sum-rows","vals","cljs.core.reduce.cljs$core$IFn$_invoke$arity$2","cljs.core/+","jasminegui.tables/median","coll","sorted","cljs.core.sort.cljs$core$IFn$_invoke$arity$1","cljs.core.remove.cljs$core$IFn$_invoke$arity$2","cljs.core/nil?","cnt","cljs.core/count","halfway","cljs.core/quot","cljs.core/odd?","cljs.core.nth.cljs$core$IFn$_invoke$arity$2","bottom","bottom-val","top-val","jasminegui.tables/nff","js/goog.i18n.NumberFormat","goog.i18n.NumberFormat.Format/DECIMAL","jasminegui.tables/nf","x","jasminegui.tables/round-to-thousand","jasminegui.tables/tnfmt","cljs.core.comp.cljs$core$IFn$_invoke$arity$2","jasminegui.tables/nfcell","this","reagent.core/as-element","temp__5733__auto__","jasminegui.tables/case-insensitive-filter","filterfn","row","jasminegui.tables/txt-format","fmt","m","G__42254","G__42255","goog.string/format","jasminegui.tables/round3","cljs.core.partial.cljs$core$IFn$_invoke$arity$3","jasminegui.tables/round2","jasminegui.tables/round1","jasminegui.tables/yield-format","jasminegui.tables/zspread-format","jasminegui.tables/round2*100","jasminegui.tables/rating-sort","a","b","cljs.core/deref","t","G__42256","re-frame.core/subscribe","G__42257","cljs.core.keyword.cljs$core$IFn$_invoke$arity$1","G__42258","jasminegui.tables/roundpc","G__42259","G__42260","jasminegui.tables/round0pc","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","jasminegui.tables/round1pc","jasminegui.tables/round2pc","jasminegui.tables/round1pcytd","style","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","G__42261","G__42262","jasminegui.tables/compare-nb","input","rowval","G__42264","cljs.core.subs.cljs$core$IFn$_invoke$arity$3","cljs.reader.read_string.cljs$core$IFn$_invoke$arity$1","cljs.core.subs.cljs$core$IFn$_invoke$arity$2","jasminegui.tables/rating-score-to-string","jasminegui.tables/table-columns","cljs.core/first"],"sourcesContent":["(ns jasminegui.tables\r\n  (:require\r\n    ; [oz.core :as oz]\r\n    [re-frame.core :as rf]\r\n    [reagent.core :as r]\r\n    [goog.string :as gstring]\r\n    [goog.string.format])\r\n  (:import (goog.i18n NumberFormat)\r\n           (goog.i18n.NumberFormat Format))\r\n\r\n    )\r\n\r\n;AGGREGATION\r\n(defn sum-rows [vals] (reduce + vals))\r\n\r\n(defn median [coll]\r\n  (let [sorted (sort (remove nil? coll))\r\n        cnt (count sorted)\r\n        halfway (quot cnt 2)]\r\n    (cond\r\n      (zero? cnt) nil\r\n      (odd? cnt) (nth sorted halfway)\r\n      :else (let [bottom (dec halfway) bottom-val (nth sorted bottom) top-val (nth sorted halfway)] (* 0.5 (+ bottom-val top-val))))))\r\n\r\n(def nff (NumberFormat. Format/DECIMAL))\r\n(defn nf [x] (.format nff (str x)))\r\n(defn round-to-thousand [x] (* 1000 (int (/ x 1000.))))\r\n(def tnfmt (comp nf round-to-thousand))\r\n\r\n\r\n(defn nfcell [this]\r\n  (r/as-element\r\n    (if-let [x (aget this \"value\")]\r\n      [:div  (nf (int x))]\r\n      \"-\")))\r\n\r\n\r\n(defn case-insensitive-filter [filterfn row]\r\n  \"filterfn is {id: column_name value: text_in_filter_box\"\r\n  ;(println row)\r\n  (.includes (.toLowerCase (str (aget row (aget filterfn \"id\")))) (.toLowerCase (aget filterfn \"value\")))\r\n\r\n  ;(or\r\n  ;  (.includes (.toLowerCase (str (aget row (aget filterfn \"id\")))) (.toLowerCase (aget filterfn \"value\")))\r\n  ;  (.includes (.toLowerCase (str (aget row (aget filterfn \"_pivotId\")))) (.toLowerCase (aget filterfn \"value\")))\r\n  ;  )\r\n\r\n  )\r\n\r\n(defn txt-format [fmt m this]    (r/as-element (if-let [x (aget this \"value\")] (gstring/format fmt (* m x)) \"-\")))\r\n(def round3         (partial txt-format \"%.3f\" 1.))\r\n(def round2         (partial txt-format \"%.2f\" 1.))\r\n(def round1         (partial txt-format \"%.1f\" 1.))\r\n(def yield-format   (partial txt-format \"%.2f%\" 1.))\r\n(def zspread-format (partial txt-format \"%.0fbps\" 1.))\r\n(def round2*100     (partial txt-format \"%.2f\" 100.))\r\n\r\n(defn rating-sort [a b]\r\n  (let [t @(rf/subscribe [:rating-to-score])] (<= (t (keyword a)) (t (keyword b)))))\r\n\r\n\r\n\r\n(defn roundpc [fmt this]\r\n  (r/as-element\r\n    (if-let [x (aget this \"value\")]\r\n      [:div {:style {:color (if (neg? x) \"red\" \"black\")}} (gstring/format fmt (* 100 x))]\r\n      \"-\")))\r\n\r\n(def round0pc (partial roundpc \"%.0f%\"))\r\n(def round1pc (partial roundpc \"%.1f%\"))\r\n(def round2pc (partial roundpc \"%.2f%\"))\r\n\r\n(defn round1pcytd  [this]\r\n  (r/as-element\r\n    (if-let [x (aget this \"value\")]\r\n      (let [style (merge (if (neg? x) {:color \"red\"} {:color \"black\"})\r\n                         (if (aget this \"row\" \"thisyear\") {:font-style \"italic\"} {}))]\r\n        [:div {:style style} (gstring/format \"%.1f%\" (* 100 x))])\r\n      \"-\")))\r\n\r\n(defn compare-nb [filterfn row]\r\n  \"filterfn is {id: column_name value: text_in_filter_box\"\r\n  (let [input (aget filterfn \"value\")\r\n        rowval (aget row (aget filterfn \"id\"))]\r\n    (case (subs input 0 1)\r\n      \">\" (> rowval (cljs.reader/read-string (subs input 1)))\r\n      \"<\" (< rowval (cljs.reader/read-string (subs input 1)))\r\n      (> rowval (cljs.reader/read-string input)))))\r\n\r\n\r\n\r\n(defn rating-score-to-string [this] (aget this \"row\" \"qt-iam-int-lt-median-rating\"))\r\n\r\n\r\n(def table-columns\r\n  {:id                          {:Header \"ID\"             :accessor \"id\"                          :show false}\r\n   :id-show                     {:Header \"ID\"             :accessor \"id\"                          :width 75}\r\n   :region                      {:Header \"Region\"         :accessor \"jpm-region\" :width 140 }\r\n   :country                     {:Header \"Country\"        :accessor \"qt-risk-country-name\" :width 140}\r\n   :issuer                      {:Header \"Issuer\"         :accessor \"TICKER\" :width 140 }\r\n   :sector                      {:Header \"Sector\"         :accessor \"qt-jpm-sector\" :width 140}\r\n   :maturity-band               {:Header \"Maturity\"       :accessor \"qt-final-maturity-band\" :width 140}\r\n   :rating                      {:Header \"Rating\"         :accessor \"qt-iam-int-lt-median-rating\" :show false}  ; :show false\r\n   ;  :rating                      {:Header \"Rating\" :accessor \"qt-iam-int-lt-median-rating\"  :show false} :sortMethod rating-sort} ; :show false\r\n   :rating-score                {:Header \"Rating\"         :accessor \"qt-iam-int-lt-median-rating-score\" :Cell rating-score-to-string :aggregate first}\r\n   :name                        {:Header \"Name\"           :accessor \"NAME\" :width 140} ;  :filterMethod case-insensitive-filter\r\n   :isin                        {:Header \"ISIN\"           :accessor \"isin\"                        :width 125 } ;:style {:textAlign \"center\"}\r\n   :description                 {:Header \"thinkFolio ID\"  :accessor \"description\" :width 500}\r\n   :nav                         {:Header \"Fund\"           :accessor \"weight\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2*100 :filterable true :filterMethod compare-nb}\r\n   :bm-weight                   {:Header \"Index\"          :accessor \"bm-weight\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2*100 :filterable true :filterMethod compare-nb}\r\n   :nominal                     {:Header \"Nominal\"        :accessor \"original-quantity\" :width 120 :style {:textAlign \"right\"} :aggregate sum-rows :Cell nfcell :filterable true :filterMethod compare-nb}\r\n   :z-spread                    {:Header \"Z-spread\"       :accessor \"qt-libor-spread\" :width 80 :style {:textAlign \"right\"} :aggregate median :Cell nfcell :filterable true :filterMethod compare-nb}\r\n   :g-spread                    {:Header \"G-spread\"       :accessor \"qt-govt-spread\" :width 80 :style {:textAlign \"right\"} :aggregate median :Cell nfcell :filterable true :filterMethod compare-nb}\r\n   :duration                    {:Header \"M dur\"          :accessor \"qt-modified-duration\" :width 60 :style {:textAlign \"right\"} :aggregate median :Cell round2 :filterable true :filterMethod compare-nb}\r\n   :yield                       {:Header \"Yield\"          :accessor \"qt-yield\" :width 60 :style {:textAlign \"right\"} :aggregate median :Cell round2pc :filterable true :filterMethod compare-nb}\r\n   :value                       {:Header \"Value\"          :accessor \"base-value\" :width 120 :style {:textAlign \"right\"} :aggregate sum-rows :Cell nfcell :filterable true :filterMethod compare-nb}\r\n   :contrib-gspread             {:Header \"G-spread\"       :accessor \"contrib-gspread\" :width 80 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round1 :filterable false}\r\n   :contrib-zspread             {:Header \"Fund\"           :accessor \"contrib-zspread\" :width 80 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round1 :filterable false}\r\n   :contrib-yield               {:Header \"Fund\"           :accessor \"contrib-yield\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2pc :filterable false}\r\n   :contrib-mdur                {:Header \"Fund\"           :accessor \"contrib-mdur\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2 :filterable false}\r\n   :bm-contrib-yield            {:Header \"Index\"          :accessor \"bm-contrib-yield\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2pc :filterable false}\r\n   :bm-contrib-eir-duration     {:Header \"Index\"          :accessor \"bm-contrib-eir-duration\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2 :filterable false}\r\n   :cash-pct                    {:Header \"Cash\"           :accessor \"cash-pct\" :width 60 :style {:textAlign \"right\"} :Cell round2pc :filterable false}\r\n   :contrib-bond-yield          {:Header \"Bond yield\"     :accessor \"contrib-bond-yield\" :width 80 :style {:textAlign \"right\"} :Cell round2pc :filterable false}\r\n   :weight-delta                {:Header \"Delta\"          :accessor \"weight-delta\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2*100 :filterable true :filterMethod compare-nb}\r\n   :mdur-delta                  {:Header \"Delta\"          :accessor \"mdur-delta\" :width 60 :style {:textAlign \"right\"} :aggregate sum-rows :Cell round2 :filterable false}\r\n\r\n   })\r\n\r\n"]}